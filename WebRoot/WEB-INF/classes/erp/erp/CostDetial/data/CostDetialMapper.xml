<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="erp.erp.CostDetial.data.CostDetialMapper">


<select id="getCostDetialList" parameterType="map" resultType="erp.erp.CostDetial.model.CostDetial">
select aa.* from (SELECT  cgfyb.fydh,
			cgfyb.fyxh,
			cgfyb.fyrq,
			cgfyb.yhbh,
			cgfyb.csbh,
			cgfyb.fyzy,
			cgfyb.fysl,   
			cgfyb.fydj,
			cgfyb.fyje,
			cgfyb.zzsl,
			cgfyb.csdj,
			cgfyb.csje,
			cgfyb.fyje - cgfyb.csje as zzse,
			cgfyb.jhbh,
			cgfyb.jhxh,
			cgfyb.htbh,
			cgfyb.htxh,
			cgfyb.fylx,
         case when cgfyb.jhbh&lt;&gt;0 then ltrim(rtrim(str(cgfyb.jhbh)))+'-'+ltrim(rtrim(str(cgfyb.jhxh))) end as jhh,
         case when cgfyb.htbh&lt;&gt;0 then ltrim(rtrim(str(cgfyb.htbh)))+'-'+ltrim(rtrim(str(cgfyb.htxh))) end as hth,
			cgfyb.bzsm,
			cgfyb.hxbj,
			cgfyb.fplb,
			cgfyb.fphm,
			cgfyb.sdbj,
			cgfyb.sdrm,
			cgfyb.sdsj,
			cgfyb.czym,
			cgfyb.czsj,
			cgfyb.tzdh,
			cgfyb.hxrq,
			cgfyb.fzhm,
			cgfyb.cfxh,
			yfjzb.jzzt,
			csxxb.csmc,
			cgfyb.hsbm,
			cgfyb.zflb,
			case when len(cgfyb.zflb)>=4 then left(cgfyb.zflb,2) else '' end as sjzflb,
			cgfyb.xslb,
			cgfyb.spbj,
			cgfyb.sprm,
			cgfyb.spsj,
			cgfyb.tjbj,
			cgfyb.tjrm,
			cgfyb.tjsj,
			cgfyb.fyxs,
			case when cgfyb.wxdh&lt;&gt;0 then ltrim(rtrim(str(cgfyb.wxdh)))+'-'+ltrim(rtrim(str(cgfyb.wxxh))) end as rwh,
			cgfyb.wbbh,
			cgfyb.wbhl,
			cgfyb.wbje,
			cgfyb.cglb,
			czyb.ssbm,
			hsbmb.bmmc,
			wbmcb.wbdh,
			xslbb.lbmc as xslbmc,
			zjzflbb.lbmc as zflbmc,
			z.lbmc as sjzflbmc,
			h.lbmc as ssbmmc,
			sysxxb.yhjc,
			fplxb.fplx as fplbmc
    FROM cgfyb with (nolock)
    left outer join yfjzb with (nolock) on year(cgfyb.fyrq) = yfjzb.nd and month(cgfyb.fyrq) = yfjzb.yf
	left outer join czyb with (nolock) on czyb.czy_xm=cgfyb.czym
	left outer join xslbb  with (nolock) on xslbb.lbbh=cgfyb.xslb	
	left outer join hsbmb  with (nolock) on hsbmb.bmbh=cgfyb.hsbm
	left outer join czybmlbb h with (nolock) on h.lbbh=czyb.ssbm
    left outer join wbmcb  with(nolock) on cgfyb.wbbh = wbmcb.wbbh
    left outer join csxxb with (nolock) on csxxb.csbh=cgfyb.csbh
    left outer join zjzflbb with (nolock) on zjzflbb.lbbh=cgfyb.zflb
    left outer join zjzflbb  z with (nolock) on z.lbbh=(left(cgfyb.zflb,2))
    left outer join sysxxb with (nolock) on sysxxb.yhbh = cgfyb.yhbh
    left outer join fplxb with (nolock) on fplxb.lxbh = cgfyb.fplb
    <where>
       1 = 1
       <if test="hsbm!=null and hsbm!=0">
	     and left(cgfyb.hsbm,len(#{hsbm})) = #{hsbm}
	   </if>
	   <if test="qsrq!=null and qsrq!=''">
	     and cgfyb.fyrq &gt;= #{qsrq}
	   </if>
	   <if test="jzrq!=null and jzrq!=''">
	     and cgfyb.fyrq &lt;= #{jzrq}
	   </if>
	   <if test="csbh!=null and csbh!=''">
	     and cgfyb.csbh = #{csbh} <!-- or csxxb.csmc like '%${csbh}%' -->
	   </if>
	   <if test="czym!=null and czym!=''">
	     and cgfyb.czym like '%${czym}%'
	   </if>
	   <if test="condition!=null and condition!=''">
		and ${condition}
	   </if>
	   <if test="bmqx!=null">
	     ${bmqx}	
	   </if>
    </where>
    )aa
     where
        1=1 
    <if test="filterSearch!=null">
	  ${filterSearch}
     </if>
    order by fyrq desc 
</select>
<insert id="addCostDetial" parameterType="erp.erp.CostDetial.model.CostDetial" keyProperty="" useGeneratedKeys="true">
	insert into dbo.cgfyb
	(
		fydh,
		fyxh,
		fyrq,
		yhbh,
		cglb,
		csbh,
		fyzy,
		fysl,
		fydj,
		fyje,
		fylb,
		jhbh,
		jhxh,
		bzsm,
		hxbj,
		hxrq,
		fplb,
		fphm,
		sdbj,
		sdrm,
		sdsj,
		czym,
		czsj,
		tzdh,
		cfxh,
		fzhm,
		htbh,
		htxh,
		fybz,
		zzsl,
		csdj,
		csje,
		hsdh,
		hsxh,
		hsbm,
		spbj,
		sprm,
		spyj,
		spsj,
		tjbj,
		tjrm,
		tjsj,
		tjdx,
		cybh,
		fylx,
		fpdx,
		fyxz,
		wbbh,
		wbhl,
		wbje,
		wxdh,
		wxxh,
		shdh,
		shxh,
		dybj,
		dysj,
		gxbh,
		jlbh,
		ycdh,
		jlxh,
		ckbh,
		dbdh,
		dbxh,
		fypc,
		ftms,
		ftxs,
		fsbm,
		xslb,
		fhdh,
		fhxh,
		fhck,
		gzdh,
		gzxh,
		mxzs,
		fyxs,
		zflb,
		dcrq,
		dbxs,
		ystj,
		zyrm,
		sgtzh,
		zgbh,
		zgxh,
		xkxj,
		cglx,
		zlrkdh,
		zlrkxh,
		zlckbh,
		zlckbh
	)
	values
	(
		#{fydh},
		#{fyxh},
		#{fyrq},
		#{yhbh},
		#{cglb},
		#{csbh},
		#{fyzy},
		#{fysl},
		#{fydj},
		#{fyje},
		#{fylb},
		#{jhbh},
		#{jhxh},
		#{bzsm},
		#{hxbj},
		#{hxrq},
		#{fplb},
		#{fphm},
		#{sdbj},
		#{sdrm},
		#{sdsj},
		#{czym},
		#{czsj},
		#{tzdh},
		#{cfxh},
		#{fzhm},
		#{htbh},
		#{htxh},
		#{fybz},
		#{zzsl},
		#{csdj},
		#{csje},
		#{hsdh},
		#{hsxh},
		#{hsbm},
		#{spbj},
		#{sprm},
		#{spyj},
		#{spsj},
		#{tjbj},
		#{tjrm},
		#{tjsj},
		#{tjdx},
		#{cybh},
		#{fylx},
		#{fpdx},
		#{fyxz},
		#{wbbh},
		#{wbhl},
		#{wbje},
		#{wxdh},
		#{wxxh},
		#{shdh},
		#{shxh},
		#{dybj},
		#{dysj},
		#{gxbh},
		#{jlbh},
		#{ycdh},
		#{jlxh},
		#{ckbh},
		#{dbdh},
		#{dbxh},
		#{fypc},
		#{ftms},
		#{ftxs},
		#{fsbm},
		#{xslb},
		#{fhdh},
		#{fhxh},
		#{fhck},
		#{gzdh},
		#{gzxh},
		#{mxzs},
		#{fyxs},
		#{zflb},
		#{dcrq},
		#{dbxs},
		#{ystj},
		#{zyrm},
		#{sgtzh},
		#{zgbh},
		#{zgxh},
		#{xkxj},
		#{cglx},
		#{zlrkdh},
		#{zlrkxh},
		#{zlckbh},
		#{zlckbh}
	)
</insert>
<update id="updateCostDetial" parameterType="erp.erp.CostDetial.model.CostDetial">
	update dbo.cgfyb
		set
			fydh = #{fydh},
			fyxh = #{fyxh},
			fyrq = #{fyrq},
			yhbh = #{yhbh},
			cglb = #{cglb},
			csbh = #{csbh},
			fyzy = #{fyzy},
			fysl = #{fysl},
			fydj = #{fydj},
			fyje = #{fyje},
			fylb = #{fylb},
			jhbh = #{jhbh},
			jhxh = #{jhxh},
			bzsm = #{bzsm},
			hxbj = #{hxbj},
			hxrq = #{hxrq},
			fplb = #{fplb},
			fphm = #{fphm},
			sdbj = #{sdbj},
			sdrm = #{sdrm},
			sdsj = #{sdsj},
			czym = #{czym},
			czsj = #{czsj},
			tzdh = #{tzdh},
			cfxh = #{cfxh},
			fzhm = #{fzhm},
			htbh = #{htbh},
			htxh = #{htxh},
			fybz = #{fybz},
			zzsl = #{zzsl},
			csdj = #{csdj},
			csje = #{csje},
			hsdh = #{hsdh},
			hsxh = #{hsxh},
			hsbm = #{hsbm},
			spbj = #{spbj},
			sprm = #{sprm},
			spyj = #{spyj},
			spsj = #{spsj},
			tjbj = #{tjbj},
			tjrm = #{tjrm},
			tjsj = #{tjsj},
			tjdx = #{tjdx},
			cybh = #{cybh},
			fylx = #{fylx},
			fpdx = #{fpdx},
			fyxz = #{fyxz},
			wbbh = #{wbbh},
			wbhl = #{wbhl},
			wbje = #{wbje},
			wxdh = #{wxdh},
			wxxh = #{wxxh},
			shdh = #{shdh},
			shxh = #{shxh},
			dybj = #{dybj},
			dysj = #{dysj},
			gxbh = #{gxbh},
			jlbh = #{jlbh},
			ycdh = #{ycdh},
			jlxh = #{jlxh},
			ckbh = #{ckbh},
			dbdh = #{dbdh},
			dbxh = #{dbxh},
			fypc = #{fypc},
			ftms = #{ftms},
			ftxs = #{ftxs},
			fsbm = #{fsbm},
			xslb = #{xslb},
			fhdh = #{fhdh},
			fhxh = #{fhxh},
			fhck = #{fhck},
			gzdh = #{gzdh},
			gzxh = #{gzxh},
			mxzs = #{mxzs},
			fyxs = #{fyxs},
			zflb = #{zflb},
			dcrq = #{dcrq},
			dbxs = #{dbxs},
			ystj = #{ystj},
			zyrm = #{zyrm},
			sgtzh = #{sgtzh},
			zgbh = #{zgbh},
			zgxh = #{zgxh},
			xkxj = #{xkxj},
			cglx = #{cglx},
			zlrkdh = #{zlrkdh},
			zlrkxh = #{zlrkxh},
			zlckbh = #{zlckbh},
			zlckbh = #{zlckbh}
		where  = #{}
</update>
<delete id="deleteCostDetial" parameterType="erp.erp.CostDetial.model.CostDetial">
	delete from dbo.cgfyb
	where  = #{}
</delete>
</mapper>
