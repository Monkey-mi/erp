<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="erp.erp.master.purchaseCost.data.SendImpMapper">


<select id="getSendImpList" parameterType="map" resultType="erp.erp.master.purchaseCost.model.SendImp">
	select aa.* from (SELECT 	ypdsb.jlbh,   
         ypdsb.xslb,   
         ypdsb.dsdw,   
         ypdsb.dsfs,   
         ypdsb.dsyq,   
         ypdsb.dsfy,   
         ypdsb.ypzl,   
         ypdsb.fkfs,   
         ypdsb.jsbj,    
         ypdsb.jbrm,    
         ypdsb.wtrm,    
         ypdsb.sjdw,   
         ypdsb.sjdh,   
         ypdsb.sjrq,   
         ypdsb.sjrm,   
         ypdsb.gdbj,   
         ypdsb.czym,   
         ypdsb.czsj, 
			ypdsb.hsbm ,   
			ypdsb.sjdz ,    
			ypdsb.sjrq as jjrq,     
			ypdsb.sqrq,      
			ypdsb.qfbj,     
        	ypdsb.cybh,
			ypdsb.fffs, 
			ypdsb.sfbj,
         ypdsb.sdbj,  
			ypdsb.sdrm,  
			ypdsb.sdsj,  
			ypdsb.yjbj,  
			ypdsb.yjrm,  
			ypdsb.yjsj,    
		   ypdsb.khbh , 
         ypdsb.dfzh,
		   ypdsb.tj,
		   ypdsb.jfzl,
			ypdsb.dsxs,
			ypdsb.bzsm,
			ypdsb.kdlx,
			ypdsb.djlx,
			ypdsb.fphm,
			ypdsb.kdry,
			csxxb.CSMC,
			ypdsb.csbh,
			isnull(ypdsb.dsfy,0) - isnull((select sum(cgfyb.fyje) from cgfyb with (nolock) where cgfyb.jlbh=ypdsb.jlbh),0) as wdje
    FROM ypdsb with (nolock)
left outer join csxxb with (nolock) on csxxb.csbh=ypdsb.csbh
where ypdsb.gdbj=0 and isnull(ypdsb.dsfy,0) - isnull((select sum(cgfyb.fyje) from cgfyb with (nolock) where cgfyb.jlbh=ypdsb.jlbh),0)>0 and ypdsb.qfbj=1
   <if test="sjdh!=null">
   	  and left(sjdh,len(#{sjdh})) = #{sjdh}
   </if>
)aa
</select>
<insert id="addSendImp" parameterType="erp.erp.master.purchaseCost.model.SendImp" keyProperty="" useGeneratedKeys="true">
	insert into dbo.ypdsb
	(
		jlbh,
		xslb,
		ywym,
		dsdw,
		dsfs,
		dsyq,
		ypzl,
		dsfy,
		fkfs,
		jsbj,
		jbrm,
		wtrm,
		sjdw,
		sjrq,
		sjdh,
		sjrm,
		czym,
		czsj,
		gdbj,
		hsbm,
		sjdz,
		jjrq,
		sqrq,
		qfbj,
		cybh,
		fffs,
		sfbj,
		sdrm,
		sdsj,
		sdbj,
		yjrm,
		yjsj,
		yjbj,
		tj,
		jfzl,
		khbh,
		dfzh,
		dsxs,
		bzsm,
		kdlx,
		djlx,
		fphm,
		wbfy,
		wbbh,
		wbhl,
		kdry,
		csbh,
		ssbm,
		ydfy,
		gbdq,
		cybh_hz,
		yjyf
	)
	values
	(
		#{jlbh},
		#{xslb},
		#{ywym},
		#{dsdw},
		#{dsfs},
		#{dsyq},
		#{ypzl},
		#{dsfy},
		#{fkfs},
		#{jsbj},
		#{jbrm},
		#{wtrm},
		#{sjdw},
		#{sjrq},
		#{sjdh},
		#{sjrm},
		#{czym},
		#{czsj},
		#{gdbj},
		#{hsbm},
		#{sjdz},
		#{jjrq},
		#{sqrq},
		#{qfbj},
		#{cybh},
		#{fffs},
		#{sfbj},
		#{sdrm},
		#{sdsj},
		#{sdbj},
		#{yjrm},
		#{yjsj},
		#{yjbj},
		#{tj},
		#{jfzl},
		#{khbh},
		#{dfzh},
		#{dsxs},
		#{bzsm},
		#{kdlx},
		#{djlx},
		#{fphm},
		#{wbfy},
		#{wbbh},
		#{wbhl},
		#{kdry},
		#{csbh},
		#{ssbm},
		#{ydfy},
		#{gbdq},
		#{cybh_hz},
		#{yjyf}
	)
</insert>
<update id="updateSendImp" parameterType="erp.erp.master.purchaseCost.model.SendImp">
	update dbo.ypdsb
		set
			jlbh = #{jlbh},
			xslb = #{xslb},
			ywym = #{ywym},
			dsdw = #{dsdw},
			dsfs = #{dsfs},
			dsyq = #{dsyq},
			ypzl = #{ypzl},
			dsfy = #{dsfy},
			fkfs = #{fkfs},
			jsbj = #{jsbj},
			jbrm = #{jbrm},
			wtrm = #{wtrm},
			sjdw = #{sjdw},
			sjrq = #{sjrq},
			sjdh = #{sjdh},
			sjrm = #{sjrm},
			czym = #{czym},
			czsj = #{czsj},
			gdbj = #{gdbj},
			hsbm = #{hsbm},
			sjdz = #{sjdz},
			jjrq = #{jjrq},
			sqrq = #{sqrq},
			qfbj = #{qfbj},
			cybh = #{cybh},
			fffs = #{fffs},
			sfbj = #{sfbj},
			sdrm = #{sdrm},
			sdsj = #{sdsj},
			sdbj = #{sdbj},
			yjrm = #{yjrm},
			yjsj = #{yjsj},
			yjbj = #{yjbj},
			tj = #{tj},
			jfzl = #{jfzl},
			khbh = #{khbh},
			dfzh = #{dfzh},
			dsxs = #{dsxs},
			bzsm = #{bzsm},
			kdlx = #{kdlx},
			djlx = #{djlx},
			fphm = #{fphm},
			wbfy = #{wbfy},
			wbbh = #{wbbh},
			wbhl = #{wbhl},
			kdry = #{kdry},
			csbh = #{csbh},
			ssbm = #{ssbm},
			ydfy = #{ydfy},
			gbdq = #{gbdq},
			cybh_hz = #{cybh_hz},
			yjyf = #{yjyf}
		where  = #{}
</update>
<delete id="deleteSendImp" parameterType="erp.erp.master.purchaseCost.model.SendImp">
	delete from dbo.ypdsb
	where  = #{}
</delete>
</mapper>
